{% extends 'backend/base_dashboard.html' %}
{% block sidebar %}
  {% include 'backend/sidebar.html' %}
{% endblock %} 
{% block content %}
  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="x_panel tile fixed">

	    <div class="x_title">
	    <h2>Daashboard</h2>
	    <ul class="nav navbar-right panel_toolbox">
	      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
	      <li class="dropdown">
	        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
	        <ul class="dropdown-menu" role="menu">
	          <li><a href="#">Settings 1</a>
	          </li>
	          <li><a href="#">Settings 2</a>
	          </li>
	        </ul>
	      </li>
	      <li><a class="close-link"><i class="fa fa-close"></i></a>
	      </li>
	    </ul>
	    <div class="clearfix"></div>
	  	</div>
	    <br>

	    <div class="x_content">
	    	<div class="row top_tiles">
              <div class="animated flipInY col-lg-3 col-md-3 col-sm-6 col-xs-12">
                <div class="tile-stats">
                  <div class="left icon"><i class="fa fa-tachometer"></i></div>
                  <div class="count"><h3>124.136 KM</h3></div>
                  <h2> Total Jarak Tempuh </h2>
                  <p></p>
                </div>
              </div>
              <div class="animated flipInY col-lg-3 col-md-3 col-sm-6 col-xs-12">
                <div class="tile-stats">
                  <div class="icon"><i class="fa fa-eye"></i></div>
                  <div class="count"><h3>179,456</h3></div>
                  <h2>Total Viewer</h2>
                  <p></p>
                </div>
              </div>
              <div class="animated flipInY col-lg-3 col-md-3 col-sm-6 col-xs-12">
                <div class="tile-stats">
                  <div class="icon"><i class="fa fa-automobile"></i></div>
                  <div class="count"><h3 id="totalUnit">-</h3></div>
                  <h2>Total Unit</h2>
                  <p></p>
                </div>
              </div>
              <div class="animated flipInY col-lg-3 col-md-3 col-sm-6 col-xs-12">
                <div class="tile-stats">
                  <div class="icon"><i class="fa fa-check-square-o"></i></div>
                  <div class="count"><h3>1 Month</h3></div>
                  <h2>Durasi Campaign</h2>
                  <p></p>
                </div>
              </div>
              <div class="clearfix"></div>
            </div>
            <br>

            <div class="col-md-12 col-sm-12 col-xs-12">
            	<table id="drive" class="table table-striped table-bordered" style="width:100%">
				    <thead>
				        <tr>
				            <th>Area</th>
				            <th>Jumlah Unit</th>
				        </tr>
				    </thead>
				    <tbody id="tableArea">
				    </tbody>
				</table>
            </div>

            <div class="col-md-12 col-sm-12 col-xs-12"
            	style="max-height: 340px; overflow-y: auto;">
            	<table id="drive2" class="table table-striped table-bordered" style="width:100%">
				    <thead>
				        <tr>
				            <th>License No</th>
				            <th>Last Location</th>
				            <th>Status Vehicle</th>
				            <th>Status Engine</th>
				            <th>Detail</th>
				        </tr>
				    </thead>
				    <tbody id="tableDriver">
				        
				    </tbody>
				</table>
            </div>

	    </div> <!-- close x content -->


      </div> <!-- closse xpanel -->
    </div> <!-- close col -->
</div> <!-- close row -->`

  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="x_panel tile fixed">

	    <div class="x_content">
	    	<div class="form-group">
                <label for="province">Province :</label>
                  <select class="form-control" onchange="initMap()" name="province" id="province">
                    <option selected='selected' value="31">DKI Jakarta</option>
                    <option value="36">Banten</option>
                    <option value="32">Jawa Barat</option>
                    <option value="12">Sumatra Utara</option>
                  </select>
                  <div class="clearfix"></div>
                </div>
                <div id="googleMap" style="width:100%;height:700px;"></div>
                <br>
	    </div> <!-- close x content -->
	    

      </div> <!-- closse xpanel -->
    </div> <!-- close col -->
</div> <!-- close row -->
<!-- Route Modal -->
<div class="modal fade" id="routeModal" role="dialog">
<div class="modal-dialog modal-lg">

  <!-- Route content-->
  <div class="modal-content">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal">&times;</button>
      <h4 class="modal-title">Route</h4>
    </div>
    <div class="modal-body">
    	<div id="googleHeatMap" style="width:100%;height:700px;"></div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
    </div>
  </div>
  
</div>
</div>
        <!-- /page content -->
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAj7tSdjukVN4virXCXLUnKLJ4UR_gXVG0&callback=initMap"></script><script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAj7tSdjukVN4virXCXLUnKLJ4UR_gXVG0&libraries=visualization">
</script>
<script src="/static/assets/vendors/jquery/dist/jquery.min.js"></script>
<script type="text/javascript">
	var SITE_URL = "http://dev.abplusscar.com/";


	lat 	= -6.11259//parseFloat(result['results'][0]['data'][0]['lat']);
	lng 	= 106.7375//parseFloat(result['results'][0]['data'][0]['lng']);
	map = new google.maps.Map(document.getElementById('googleMap'), {
	zoom 				: 5,
	center 				: {lat: lat, lng: lng},
	mapTypeId 			: google.maps.MapTypeId.ROADMAP,
	styles				: [
						  {
						    "featureType": "administrative",
						    "stylers": [
						      {
						        "visibility": "simplified"
						      }
						    ]
						  },
						  {
						    "featureType": "administrative",
						    "elementType": "geometry",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "administrative.land_parcel",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "administrative.neighborhood",
						    "stylers": [
						      {
						        "visibility": "simplified"
						      }
						    ]
						  },
						  {
						    "featureType": "landscape",
						    "stylers": [
						      {
						        "color": "#89ff88"
						      },
						      {
						        "visibility": "simplified"
						      }
						    ]
						  },
						  {
						    "featureType": "poi",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "poi",
						    "elementType": "labels.text",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "road",
						    "elementType": "labels",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "road",
						    "elementType": "labels.icon",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "road.arterial",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "road.highway",
						    "stylers": [
						      {
						        "visibility": "simplified"
						      }
						    ]
						  },
						  {
						    "featureType": "road.local",
						    "stylers": [
						      {
						        "visibility": "simplified"
						      }
						    ]
						  },
						  {
						    "featureType": "road.local",
						    "elementType": "labels",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "transit",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  },
						  {
						    "featureType": "water",
						    "stylers": [
						      {
						        "color": "#c5fff9"
						      }
						    ]
						  },
						  {
						    "featureType": "water",
						    "elementType": "labels.text",
						    "stylers": [
						      {
						        "visibility": "off"
						      }
						    ]
						  }
						]
		});

		function placeMarkers(map){
			$.ajax({
				url 		: SITE_URL + 'gps/lastlocations/',
				method		: 'get',
				dataType	: 'json',
				async : false,
			  	cache : false,
				success		: function(result) {
					var driverData = ''
					var cities = result['results'][0]['cities']
					for (var key in cities){
					  console.log( key, cities[key] );
					}
					var data = result['results'][0]['data']
					$('#totalUnit').text(data.length)
			        for (var i = 0; i < data.length; i++) {
			          var beach = data[i];
			          var marker = new google.maps.Marker({
		    			label: beach[0],   

			            position: {lat: parseFloat(beach[1]), lng: parseFloat(beach[2])},
			            map: map,
			            icon: "/static/assets/build/images/mobil.png",
			          });
			         driverData +=
				        "<tr>"+
				        	"<td>" + beach[0] + "</td>" +
				        	"<td>" + beach[6] + "</td>" +
				        	"<td>" + beach[3] + "</td>" +
				            "<td>" +
				            	"<button disabled='disabled' type='button'" +
				            	"class='btn " 
				     if(beach[4] == 'ENGINE ON'){
				         driverData +=
					    "btn-success'>"
					}else{
				         driverData +=
					    "btn-danger'>"
					}

			         driverData +=
				            	"<i class='fa fa-motorcycle'></i>" +
				            	"</button></td>" +
				            "<td>"+
				            "<button type='button' class='btn btn-info' id='route' data-toggle='modal' " +
				            	"onclick='" + 'initHeatMap("'+ beach[0] +'")' + "'"+
				            	"data-target='#routeModal'><i class='fa fa-map-marker'> Detail </i></button>" +
				        "</td></tr>"
			        }
			        $('#tableDriver').html(driverData)
				},

			});
		}

		placeMarkers(map);</script>
<script type="text/javascript">
	var SITE_URL = "http://dev.abplusscar.com/";
	function initHeatMap(license_no) {
        var propertiPeta = {
            center:new google.maps.LatLng(-6.21462,106.84513),
            zoom:10,
            mapTypeId:google.maps.MapTypeId.ROADMAP
        };
        
        var peta = new google.maps.Map(document.getElementById("googleHeatMap"), propertiPeta);
        $.ajax({
			url 		: SITE_URL + 'gps/?license_no=' + license_no,
			method		: 'get',
			dataType	: 'json',
			async : false,
		  	cache : false,
			success		: function(result) {
				console.log(result)
				var dummy = [];
				var data = result['results'][0]['data']
		        for (var i = 0; i < data.length; i++) {
					dummy.push(new google.maps.LatLng(
						parseFloat(data[i]['lat']),
						parseFloat(data[i]['lng'])));
		        }
				
			  	heatmap = new google.maps.visualization.HeatmapLayer({
			          data: dummy,
			          map: peta,
			          radius: 60,
			          opacity : 0.75,
			        });
			},

		});
	}
        
</script>
{% endblock %}